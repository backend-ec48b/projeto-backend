<h2>Lista de Pedidos</h2>

<nav class="mb-3">
    <a href="/" class="btn btn-secondary btn-sm" title="Voltar para a P√°gina Inicial">
        üè† P√°gina Inicial
    </a>
</nav>
<hr>

{{! O bot√£o de novo pedido √© vis√≠vel para todos os usu√°rios logados }}
<a href="/pedidos/novo" class="btn btn-primary mb-3">Novo Pedido</a>

{{#if pedidos.length}}
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th scope="col">Nota Fiscal (ID)</th>
                <th scope="col">CPF do Cliente</th>
                <th scope="col">Data do Pedido</th>
                <th scope="col">Produtos (Nome Agregado)</th>
                <th scope="col">A√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            {{#each pedidos}}
            <tr>
                <th scope="row">{{this._id}}</th>
                <td>{{this.clienteCpf}}</td>
                <td>{{this.data}}</td>
                <td>{{this.produtosDetalhes}}</td> {{! Corrigido para 'produtosDetalhes' se for o campo do Controller }}
                <td>
                    <a href="/pedidos/{{this._id}}" class="btn btn-info btn-sm" title="Ver Detalhes">
                        Detalhes
                    </a>
                    
                    {{! CONTROLE DE ACESSO: Exibe A√ß√µes CRUD apenas para Admin }}
                    {{#if ../is_admin}}
                        <a href="/pedidos/{{this._id}}/editar" class="btn btn-warning btn-sm" title="Editar Pedido">
                            Editar
                        </a>
                        
                        <form action="/pedidos/{{this._id}}/deletar" method="POST" style="display: inline;">
                            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Tem certeza que deseja deletar o pedido {{this._id}}?');" title="Deletar Pedido">
                                Deletar
                            </button>
                        </form>
                    {{/if}}
                </td>
            </tr>
            {{/each}}
        </tbody>
    </table>
{{else}}
    <div class="alert alert-info" role="alert">
        Nenhum pedido encontrado. 
        {{#if ../is_admin}}
            <a href="/pedidos/novo">Crie o primeiro como administrador.</a>
        {{else}}
            <a href="/pedidos/novo">Fa√ßa seu primeiro pedido!</a>
        {{/if}}
    </div>
{{/if}}